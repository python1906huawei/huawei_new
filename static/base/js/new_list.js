ec.pkg("ec.product");ec.load("ajax");ec.load("ec.box",{loadType:"lazy"});ec.load("ec.form",{loadType:"lazy"});ec.product.cid="";ec.product.sortField="";ec.product.sortType="";ec.product.prdAttrList=[];ec.product.email=ec.autoEncodeAttr(ec.account.email);ec.product.mobile=ec.autoEncodeAttr(ec.account.mobile);ec.product.chooseCategory=function(cid){ec.product.cid=cid;ec.product.post()};ec.product.chooseAttrAllValue=function(attributeId){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId",attributeId);ec.product.tmpOptAttrValue(attributeId);ec.product.post()};ec.product.chooseAttrValue=function(attributeId,orderNum,value){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId",attributeId);ec.product.tmpOptAttrValue(attributeId);var attr={};attr.attributeId=attributeId;attr.value=value;attr.orderNum=orderNum;ec.product.prdAttrList.push(attr);ec.product.post()};ec.product.tmpOptAttrValue=function(attributeId){if(attributeId=="102435"||attributeId=="102434"||attributeId=="102436"){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102434");ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102435");ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102436")}};ec.product.sort=function(sortField){cur_sortField=ec.product.sortField||"3",cur_sortType=ec.product.sortType||"0",new_sortType="";switch(sortField){case"0":new_sortType="0";break;case"2":new_sortType="0";break;default:if(sortField==cur_sortField){new_sortType=cur_sortType=="0"?"1":"0"}else if(sortField=="1"){new_sortType="1"}else{new_sortType="0"}break}ec.product.sortType=new_sortType;ec.product.sortField=sortField;ec.product.post()};ec.product.more=function(obj){var cur_more=$(obj).attr("class");if(cur_more=="more more-expand"){$(obj).attr("class","more more-drop");var height=$(obj).parent(".p-operate").next(".p-expand").find("ul").first().outerHeight();$(obj).parent(".p-operate").next(".p-expand").height(height)}else{$(obj).attr("class","more more-expand");$(obj).parent(".p-operate").next(".p-expand").removeAttr("style")}};ec.product.renderPage=function(cid,prdAttrList,sortField,sortType,page){ec.dapClick(300120001,{listid:cid,load:1});ec.product.cid=cid;ec.product.sortField=sortField;ec.product.sortType=sortType;ec.product.renderCategory();ec.product.renderAttribute(prdAttrList);ec.product.renderSort(sortField,sortType);if(!page.totalPage||page.totalPage==1)return;if(page.pageNumber){$("#page_"+page.pageNumber+" li").attr("class","page-number link pgCurrent")}if(page.pageNumber==1){$("#page_ul li").eq(0).attr("class","pgNext link first first-empty");$("#page_ul li").eq(1).attr("class","pgNext link pre pre-empty")}if(page.pageNumber==page.totalPage){$("#page_ul .next").addClass("next-empty");$("#page_ul .last").addClass("last-empty")}if(page.pageNumber>1){$("#page_ul .first").click(function(){ec.redirectTo("list-"+ec.product.cid+"-1-"+ec.product.sortField+"-"+ec.product.sortType)});$("#page_ul .pre").click(function(){ec.redirectTo("list-"+ec.product.cid+"-"+(page.pageNumber-1)+"-"+ec.product.sortField+"-"+ec.product.sortType)})}if(page.pageNumber<page.totalPage){$("#page_ul .next").click(function(){ec.redirectTo("list-"+ec.product.cid+"-"+(page.pageNumber+1)+"-"+ec.product.sortField+"-"+ec.product.sortType)});$("#page_ul .last").click(function(){ec.redirectTo("list-"+ec.product.cid+"-"+page.totalPage+"-"+ec.product.sortField+"-"+ec.product.sortType)})}};ec.product.renderCategory=function(){$(".p-expand ul").each(function(){var height=$(this).children("li").first().outerHeight();var toalHeight=$(this).outerHeight();if(toalHeight>height){$(this).parent(".p-expand").prev(".p-operate").show()}})};ec.product.renderAttribute=function(prdAttrList){for(var i=0;i<prdAttrList.length;i++){var attrValue=prdAttrList[i];var attributeId=attrValue.attributeId;if(attributeId=="102435"||attributeId=="102434"||attributeId=="102436"){$("#pro-cate-attr-102435").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102434").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102436").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102435"+" li a[order-num="+attrValue.orderNum+"]").parent("li").addClass("selected");$("#pro-cate-attr-102434"+" li a[order-num="+attrValue.orderNum+"]").parent("li").addClass("selected");$("#pro-cate-attr-102436"+" li a[order-num="+attrValue.orderNum+"]").parent("li").addClass("selected")}else{$("#pro-cate-attr-"+attrValue.attributeId).find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-"+attrValue.attributeId+" li a[order-num="+attrValue.orderNum+"]").parent("li").addClass("selected")}}ec.product.prdAttrList=prdAttrList};ec.product.renderSort=function(sortField,sortType){switch(sortField){case"0":break;case"2":$("#sort-2").addClass("sort-desc");break;default:$("#sort-"+sortField).addClass("sort-"+(sortType=="0"?"desc":"asc"));break}$("#sort-"+sortField).addClass("selected")};ec.product.post=function(page){var pageNumber=page?page:1;var cid=ec.product.cid;var prdAttrList=ec.lang.json.stringify(ec.product.prdAttrList);document.getElementById("sortField").value=ec.product.sortField;document.getElementById("sortType").value=ec.product.sortType;document.getElementById("prdAttrList").value=prdAttrList;var url="/list-"+cid+"-"+pageNumber+"-"+ec.product.sortField+"-"+ec.product.sortType,attrUrls=[];if(ec.product.prdAttrList&&ec.product.prdAttrList.length>0){for(var i=0;i<ec.product.prdAttrList.length;i++){attrUrls.push(ec.product.prdAttrList[i].attributeId+"-"+ec.product.prdAttrList[i].orderNum)}url=url+"-"+attrUrls.join("-")}window.location=url};ec.product.arrival=function(skuId,skuCode){ec.account.afterLogin(function(){ec.product.syncCustomSession();var email=ec.product.email;var mobile=ec.product.mobile;var noticeType="";var box=new ec.box($("#product-arrival-html").val(),{boxid:"product-arriva-box",boxclass:"ol_box_4",title:"到货通知",width:700,showButton:false,onopen:function(box){if(ec.util.isEmpty(email)){$("#arrival-email").css({cursor:"pointer"});$("#arrival-email").click(function(){ec.openWindow("/member/account");ec.product.bind()});$("#arrival-email").attr("class","disabled");$("#account-email").html('未绑定安全邮箱&nbsp;<a href="javascript:;" target="_blank">去绑定</a>')}else{$("#arrival-email").bind("click",function(){noticeType=ec.product.chooseNoticeType("email")});$("#account-email").html(email)}if(ec.util.isEmpty(mobile)){$("#arrival-mobile").css({cursor:"pointer"});$("#arrival-mobile").click(function(){ec.openWindow("/member/account");ec.product.bind()});$("#arrival-mobile").attr("class","disabled");$("#account-mobile").html('未绑定安全手机&nbsp;<a href="javascript:;" target="_blank">去绑定</a>')}else{$("#arrival-mobile").bind("click",function(){noticeType=ec.product.chooseNoticeType("mobile")});$("#account-mobile").html(ec.product.splitMobile(mobile))}},onok:function(box){if(noticeType.length==0){$("#arrival-error span").html("请选择一种通知方式！");$("#arrival-error").removeClass("hide");return}var type="1";var informWay=email;if(noticeType=="mobile"){type="3";informWay=mobile}$.ajax({url:"/product/arrivalMail.json",dataType:"json",type:"post",data:{informWay:informWay,type:type,skuId:skuId,skuCode:skuCode},timeout:1e4,error:function(){ec.ui.loading.hide();$("#arrival-error span").html("操作超时，请重试！");$("#arrival-error").removeClass("hide")},beforeSend:function(xhr){ec.ui.loading.show();xhr.withCredentials=true},success:function(json){ec.ui.loading.hide();if(!json.success){$("#arrival-error span").html(json.msg);$("#arrival-error").removeClass("hide");return}alert("设置成功！");$("#arrival-error").addClass("hide");box.close();$(".ol_box_mask").remove()}})},onclose:function(box){$(".ol_box_mask").remove()}});box.open();ec.product.bind=function(){box.close();$(".ol_box_mask").remove()}})};ec.product.chooseNoticeType=function(type){$("#arrival-email").removeClass("selected");$("#arrival-mobile").removeClass("selected");$("#arrival-"+type).attr("class","selected");return type};ec.product.splitMobile=function(mobile){var result="";for(var i=0;i<mobile.length;i++){if((mobile.length-i)%4==0){}result+=mobile.substring(i,i+1)}return result};ec.product.syncCustomSession=function(){(new ec.ajax).get({async:false,url:"/account/syncEmailAndMobile.json",timeout:1e4,successFunction:function(json){if(!ec.util.isEmpty(json.customerInfo)){ec.product.email=json.customerInfo.email;ec.product.mobile=json.customerInfo.mobile}return},timeoutFunction:function(){return},errorFunction:function(){return}})};ec.product.disableAddCartButtons=function(skuId){$("#add-cat-"+skuId).attr("class","p-button-cart-disabled")};ec.product.enableAddCartButtons=function(skuId){$("#add-cat-"+skuId).attr("class","p-button-cart")};ec.product.addCart=function(skuId,briefName){ec.product.disableAddCartButtons(skuId);var paras;var allSkuIds=[];allSkuIds[0]=skuId;var extendSkuId=[];extendSkuId[0]="";var types=[];types[0]=1;var quantities=[];quantities[0]=1;paras={skuIds:allSkuIds,extendSkuIds:extendSkuId,quantity:quantities,type:types};ec.cart.add(paras,{successFunction:function(json){ec.cart.getMicroCartBaseInfo(json.cart,function(json){var box=new ec.box($("#cart-tips").val(),{boxid:"product-cart-box",boxclass:"ol_box_4",showButton:false,onopen:function(box){$("#cart-briefName").textS(briefName);var cartInfo=json.cartInfo;ec.minicart.setNum(cartInfo.totalNumber);var totalOriginalPrice=0;var totalPrice=0;var preferentialPrice=0;for(var j=0;j<cartInfo.bundlerList.length;j++){var bundle=cartInfo.bundlerList[j];totalOriginalPrice+=bundle["originalPrice"]*bundle["quantity"];preferentialPrice+=bundle["preferentialPrice"]}for(var x=0;x<cartInfo.productList.length;x++){var product=cartInfo.productList[x];var quantity=product["quantity"];totalOriginalPrice+=product["ecshopPrice"]*quantity;preferentialPrice+=(product["ecshopPrice"]-product["skuPrice"])*quantity;if(product["extendList"].length>0){for(var y=0;y<product["extendList"].length;y++){var extentPrd=product["extendList"][y];var price=extentPrd["skuPrice"];totalOriginalPrice+=price*quantity}}if(product["accidentList"].length>0){for(var z=0;z<product["accidentList"].length;z++){var accidentPrd=product["accidentList"][z];var price=accidentPrd["skuPrice"];totalOriginalPrice+=price*quantity}}}totalPrice=totalOriginalPrice-preferentialPrice;$("#cart-price").html(totalPrice.toFixed(2))},onok:function(box){ec.product.gotoshoppingCart()},oncancel:function(box){box.close();$(".ol_box_mask").remove()},onclose:function(box){$(".ol_box_mask").remove()}});box.open()});ec.product.enableAddCartButtons(skuId)},errorFunction:function(json){var box=new ec.box($("#popup-tips").val(),{boxid:"product-popup-box",boxclass:"ol_box_4",showButton:false,onopen:function(box){$("#popup-tips-msg").html(json.msg)},oncancel:function(box){box.close();$(".ol_box_mask").remove()},onclose:function(box){$(".ol_box_mask").remove()}});box.open();ec.product.enableAddCartButtons(skuId)}})};ec.product.removeAtrribute=function(attrList,objPropery,objValue){return $.grep(attrList,function(cur,i){return cur[objPropery]!=objValue})};$(function(){var sortId=Number(($(".pro-cate-sort .p-values .p-expand ul li.selected").attr("id")||"").substring(5));$(".channel-list .pro-list ul li").each(function(idx,self){var $li=$(self);$li.click(function(){ec.dapClick(300120101,{Sort:["",$("#sort-1").hasClass("sort-desc")?"pricedown":"priceup","review","newes"][sortId],productId:$li.attr("data-pid"),productname:$li.attr("data-sname"),SKUCode:$li.attr("data-scode"),location:idx+1,click:1})})})});